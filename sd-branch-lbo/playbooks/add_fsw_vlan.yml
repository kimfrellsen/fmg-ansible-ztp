- name: ADD FORTISWITCH VLAN FOR FAP MANAGEMENT
  fortimgr_jsonrpc_request:
    host: "{{ ansible_host }}"
    username: "{{ ansible_user }}"
    password: "{{ ansible_password }}"
    method: add
    params: [
      {
        url: "/pm/config/adom/{{ adom_name }}/obj/fsp/vlan",
        data: {
          name: vlan_mgmt_fap,
          _dhcp-status: enable,
          vlanid: 1001,
          interface: {
            ip: [
              10.1.0.99,
              255.255.255.0
            ],
            allowaccess: [
              ping,
              fabric,
              #capwap,
              #ftm,
            ],
            auto-auth-extension-device: enable,
            ap-discover: enable,
          },
          dhcp-server: {
            default-gateway: 10.1.0.99,
            netmask: 255.255.255.0,
            dns-service: default,
            ntp-service: default,
            timezone-option: default,
            ip-range: [
              {
                start-ip: 10.1.0.1,
                end-ip: 10.1.0.98,
              },
              {
                start-ip: 10.1.0.100,
                end-ip: 10.1.0.254,
              }
            ],
          },
        },
      },
    ]

- name: ADD FORTISWITCH VLAN FOR PRODUCTION TRAFFIC
  fortimgr_jsonrpc_request:
    host: "{{ ansible_host }}"
    username: "{{ ansible_user }}"
    password: "{{ ansible_password }}"
    method: add
    params: [
      {
        url: "/pm/config/adom/{{ adom_name }}/obj/fsp/vlan",
        data: {
          name: "{{ item.name }}",
          vlanid: "{{ item.vlanid }}",
          interface: {
            allowaccess: [
              ping,
              ssh,
              https,
            ],
          },
        },
      },
    ]

  with_items:
    - name: vlan_marketing
      vlanid: 1002
    - name: vlan_support
      vlanid: 1003
    - name: vlan_finance
      vlanid: 1004
